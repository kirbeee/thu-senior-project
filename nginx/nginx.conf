server {
    listen 80;
    server_name localhost;  # 請根據實際情況設定 (例如: yourdomain.com)

    # 處理 Django 的靜態資源 (直接從 volume 讀取)
    location /static/ {
        alias /var/www/static/;
        expires 30d;
        add_header Cache-Control "public";
    }

    # 處理 Django 的媒體資源 (直接從 volume 讀取)
    location /media/ {
        alias /var/www/media/;
        expires 30d;
        add_header Cache-Control "public";
    }

    # API 請求代理到 Django 後端
    # 假設你的 Django API 都以 /api 為前置路徑，若無可考慮在 Django 設定中加上前置或在此 rewrite
    location /api/ {
        # 將 /api 前置路徑移除再轉發給 Django (如果 Django 服務根路徑為 /)
        rewrite ^/api/(.*)$ /$1 break;
        proxy_pass http://django_app:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 其他所有請求轉給 Next.js 前端
    location / {
        proxy_pass http://nextjs_app:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
